<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baatmi Point ‚Äì Post Maker</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding:16px;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:#fff;
}
.container{
  max-width:420px;
  margin:auto;
  background:#1a1a1a;
  padding:16px;
  border-radius:14px;
}
h2{
  text-align:center;
  color:#ffcc00;
  margin-top:0;
}
label{
  display:block;
  margin-top:10px;
  font-size:13px;
}
input, textarea{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #333;
  background:#262626;
  color:#fff;
}
/* Yellow Trigger Button */
button#generateBtn{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:10px;
  background:#ffcc00;
  color:#000;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
}
button#generateBtn:active{transform:scale(0.98)}

#preview{
  margin-top:14px;
  text-align:center;
}
#finalImage{
  max-width:100%;
  border-radius:10px;
  display:none;
  border: 2px solid #333;
}
#downloadBtn{
  display:none;
  margin-top:10px;
  background:#27ae60;
  color:#fff;
  text-decoration:none;
  padding:12px;
  border-radius:8px;
  font-weight:bold;
  display: block;
  text-align: center;
}

/* üîë FIX: OFF-SCREEN CANVAS (Renderable but invisible) */
/* display: none; ‡§ï‡•ã ‡§π‡§ü‡§æ‡§ï‡§∞ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à */
#postCanvas{
  position:absolute;
  left:-9999px; 
  top:0;
  width:720px;
  height:720px;
  background:#000;
}
#canvasWrap{
  position:relative;
  width:720px;
  height:720px;
}
#userImg{
  width:100%;
  height:100%;
  object-fit:cover;
}
/* Transparent Shade */
#overlay{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  background:rgba(0,0,0,0.7); /* ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§ú‡•à‡§∏‡§æ ‡§∂‡•á‡§° */
  padding:28px;
}
#headlineOut{
  font-size:34px;
  line-height:1.2;
  margin:0;
  color:#fff; /* White Headline */
}
#descOut{
  margin-top:8px;
  font-size:18px;
  color:#ffcc00; /* Yellow Description */
}
/* Watermark Styling */
#watermark{
  position:absolute;
  right:16px;
  bottom:12px;
  color:#ffcc00; /* Yellow Watermark */
  font-weight:bold;
  font-size:14px;
}
</style>
</head>

<body>

<div class="container">
  <h2>Post Maker</h2>

  <label>‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç</label>
  <input type="file" id="imageInput" accept="image/*">

  <label>‡§π‡•á‡§°‡§≤‡§æ‡§á‡§® (White)</label>
  <input type="text" id="headline" placeholder="‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§¨‡§æ‡§§ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç">

  <label>‡§µ‡§ø‡§µ‡§∞‡§£ (Yellow)</label>
  <textarea id="desc" rows="3" placeholder="‡§°‡§ø‡§ü‡•á‡§≤ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç"></textarea>

  <button id="generateBtn">‡§™‡•ã‡§∏‡•ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç</button>

  <div id="preview">
    <img id="finalImage">
    <a id="downloadBtn">‡§á‡§Æ‡•á‡§ú ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</a>
  </div>
</div>

<div id="postCanvas">
  <div id="canvasWrap">
    <img id="userImg">
    <div id="overlay">
      <h1 id="headlineOut"></h1>
      <div id="descOut"></div>
    </div>
    <div id="watermark">@baatmipoint</div>
  </div>
</div>

<script>
/* CDN guard */
if (typeof html2canvas === "undefined") {
  alert("Rendering library load failed. Please refresh once.");
}

const imgInput = document.getElementById('imageInput');
const userImg = document.getElementById('userImg');
const headlineOut = document.getElementById('headlineOut');
const descOut = document.getElementById('descOut');
const finalImage = document.getElementById('finalImage');
const downloadBtn = document.getElementById('downloadBtn');
const generateBtn = document.getElementById('generateBtn');

imgInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => userImg.src = ev.target.result;
  reader.readAsDataURL(file);
});

generateBtn.addEventListener('click', ()=>{
  if(!userImg.src || userImg.src === ""){
    alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç");
    return;
  }
  headlineOut.innerText = document.getElementById('headline').value || "";
  descOut.innerText = document.getElementById('desc').value || "";

  generateBtn.disabled = true;
  generateBtn.innerText = "‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç...";

  // html2canvas ‡§ï‡•ã ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§•‡•ã‡§°‡§º‡§æ ‡§∏‡§Æ‡§Ø ‡§¶‡•á‡§Ç
  setTimeout(() => {
      html2canvas(document.getElementById('postCanvas'), {
        scale: 2, // ‡§¨‡•á‡§π‡§§‡§∞ ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§ï‡•á‡§≤
        useCORS: true, // ‡§ï‡•ç‡§∞‡•â‡§∏-‡§ì‡§∞‡§ø‡§ú‡§ø‡§® ‡§á‡§Æ‡•á‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£
        backgroundColor: null // ‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡•Ä ‡§™‡•É‡§∑‡•ç‡§†‡§≠‡•Ç‡§Æ‡§ø ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç ‡§Ø‡§¶‡§ø ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•ã
      }).then(canvas => {
        const url = canvas.toDataURL("image/png");
        finalImage.src = url;
        finalImage.style.display = "block";
        downloadBtn.href = url;
        downloadBtn.download = "baatmipoint_post.png";
        downloadBtn.style.display = "block";
        
        generateBtn.disabled = false;
        generateBtn.innerText = "‡§™‡•ã‡§∏‡•ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç";
      }).catch(err => {
          console.error("Image generation failed:", err);
          alert("‡§á‡§Æ‡•á‡§ú ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
          generateBtn.disabled = false;
          generateBtn.innerText = "‡§™‡•ã‡§∏‡•ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç";
      });
  }, 100); // 100ms ‡§ï‡§æ ‡§õ‡•ã‡§ü‡§æ ‡§µ‡§ø‡§≤‡§Ç‡§¨
});
</script>

</body>
</html>
